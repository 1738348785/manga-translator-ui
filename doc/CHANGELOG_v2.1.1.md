# v2.1.1 更新日志

发布日期：2026-02-19

## 🐛 修复

- 修复并发流水线取消时翻译线程可能继续等待 API 返回的问题：统一取消检测链路，`stop_workers` 也会触发翻译器取消回调，确保停止信号可传递到 in-flight 请求
- 修复 OpenAI / Gemini（含 HQ）长耗时请求在取消时不及时退出的问题：API await 全部改为可轮询取消，收到取消后主动中断当前连接
- 修复重试与限速等待阶段无法及时响应取消的问题：重试 sleep 和 ratelimit sleep 统一改为可取消等待
- 修复 OpenAI / Gemini HQ 的双路径请求实现不一致问题：移除单图后备 API 分支，统一走同一套 HQ 批量翻译路径
- 修复 Gemini 普通翻译器在 curl 分支下安全设置回退不生效的问题：安全错误后可正确切换为 `safety_settings=None` 重试
- 修复停止任务时偶发 `Task was destroyed but it is pending` 警告：并发线程事件循环关闭前先取消并回收 pending tasks，再执行 loop shutdown
- 修复竖排内横排块旋转规则：仅字母/数字（长度≥3）执行 90° 旋转，符号块保持横排不旋转
- 修复 Qt 编辑器描边颜色不一致问题：新建文本框默认描边统一为白色，避免与属性面板默认值不一致（白/黑混用）
- 修复翻译重试次数边界行为：`重试次数` 现已明确支持 `0`（仅首次请求）和 `1`（首次请求 + 1 次重试），避免翻译阶段提前报错
- 修复字体路径绝对路径跨目录/跨盘符失效问题：当 region 中存储的旧绝对路径在当前机器不存在时，自动以文件名在 `fonts/` 目录兜底查找，避免字体回退到默认值导致文本框尺寸计算异常（越缩越小）

## 🔧 优化

- 优化取消场景日志完整性：翻译线程在正常/异常/取消路径都会输出线程结束日志，便于定位停止行为
- 优化字体大小输入框体验：属性面板字体大小输入框新增 `8~1000` 校验，输入大值时不再被滑条上限回写
